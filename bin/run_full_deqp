#!/bin/bash

if [ "$#" -ne 3 ]; then
    echo "usage: <renderer_check> <api> <output>"
    exit 1
fi

renderer_check=$1
api=$2
output=$3

# Disable coredumps as it would only slow it down in case of crashes.
ulimit -c 0

case $api in
    gles2)
        caselist=$OPENGL_CTS_PATH/data/mustpass/gles/aosp_mustpass/main/gles2-main.txt
        skips=$MESA_ROOT_DIR/.gitlab-ci/all-skips.txt
        ;;
    gles3)
        caselist=$OPENGL_CTS_PATH/data/mustpass/gles/aosp_mustpass/main/gles3-main.txt
        skips=$MESA_ROOT_DIR/.gitlab-ci/all-skips.txt
        ;;
    gles31)
        caselist=$OPENGL_CTS_PATH/data/mustpass/gles/aosp_mustpass/main/gles31-main.txt
        skips=$MESA_ROOT_DIR/.gitlab-ci/all-skips.txt
        ;;
    vk)
        caselist=$VULKAN_CTS_PATH/mustpass/main/vk-default.txt
        skips=$MESA_ROOT_DIR/.gitlab-ci/all-skips.txt
        ;;
    *)
        echo "Unknown API: $api"
        exit 1
        ;;
esac

export DEQP_JOBS=4
run_deqp "$renderer_check" "$api" "$caselist" "$skips" "$output" --deqp-log-images=disable

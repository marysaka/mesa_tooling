#!/bin/bash

if [ "$#" -le 4 ]; then
    echo "usage: <renderer_check> <api> <caselist> <skips> <output> [extra_args]"
    exit 1
fi

renderer_check=$1
api=$2
caselist=$3
skips=$4
output=$5
extra_args=$6

case $api in
    gles2)
        deqp_path=modules/gles2/deqp-gles2
        ;;
    gles3)
        deqp_path=modules/gles3/deqp-gles3
        ;;
    gles31)
        deqp_path=modules/gles31/deqp-gles31
        ;;
    vk)
        deqp_path=external/vulkancts/modules/vulkan/deqp-vk
        ;;
    *)
        echo "Unknown API: $api"
        exit 1
        ;;
esac

export MESA_VK_IGNORE_CONFORMANCE_WARNING=true

FRACTION=1

EGL_PLATFORM=surfaceless deqp-runner run --deqp $VK_GL_CTS_BUILD_DIR/$deqp_path \
                                         --output $output \
                                         --fraction $FRACTION \
                                         --jobs $DEQP_JOBS \
                                         --renderer-check "$renderer_check" \
                                         --caselist "$caselist" \
                                         --skips "$skips" \
                                         --testlog-to-xml $VK_GL_CTS_BUILD_DIR/executor/testlog-to-xml \
                                         -- \
                                         --deqp-surface-type=pbuffer \
                                         --deqp-gl-config-name=rgba8888d24s8ms0 \
                                         --deqp-surface-width=256 \
                                         --deqp-surface-height=256 \
                                         --deqp-visibility=hidden \
                                         $extra_args
